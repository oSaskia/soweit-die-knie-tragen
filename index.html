<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soweit die Knie tragen</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }
        #map {
            width: 100%;
            height: 100%;
        }
    </style>
</head>
<body>
    <div id="map"></div>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet-geosearch/dist/geosearch.css" />
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-geosearch/dist/bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-gpx/1.4.0/gpx.min.js"></script>
    
    <script>
        var mymap = L.map('map').setView([52.46650, 13.43371], 16);

        var openStreetMapLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: "Datenquelle: &copy; <a href='https://www.openstreetmap.org/copyright' target='_blank'>OpenStreetMap</a> contributors",
            maxZoom: 19
        }).addTo(mymap);
    
        var wmsLayer = L.tileLayer.wms("https://www.wms.nrw.de/geobasis/wms_nw_dop", {
            layers: 'nw_dop_rgb',
            format: 'image/png',
            transparent: true,
            version: '1.3.0',
            attribution: "Datenquelle: <a href='https://open.nrw/' target='_blank'>Geobasis NRW</a> (<a href='https://www.govdata.de/dl-de/zero-2-0' target='_blank'>DL-DE->Zero-2.0</a>)",
            maxZoom: 19
        });
    
        var marker = L.marker([52.46650, 13.43371], {
            title: "Start - 17.05.24"
        }).addTo(mymap);
        marker.bindPopup("<b>Start - 17.05.24</b>").closePopup();
    
        var geojsonFeature = {
            "type": "Feature",
            "geometry": {
                "type": "LineString",
                "coordinates": [
                    [13.4050, 52.5200], // Berlin
                    [11.5820, 48.1351]  // Munich
                ]
            },
            "properties": {
                "name": "Line from Berlin to Munich"
            }
        };

        L.geoJSON(geojsonFeature, {
            title: "geplante Route",
            style: function(feature) {
                return {
                    color: 'red',    // Red color
                    weight: 5        // Thickness
                };
            }
        }).addTo(mymap);

        var baseMaps = {
            "OpenStreetMap": openStreetMapLayer,
            "Luftbilder": wmsLayer
        };

        L.control.layers(baseMaps).addTo(mymap);
    
        // Geosearch mit OpenStreetMap-Geocoder hinzufügen
        const search = new GeoSearch.GeoSearchControl({
            provider: new GeoSearch.OpenStreetMapProvider(),
            autoComplete: true, // Automatische Vervollständigung aktivieren
            autoCompleteDelay: 250, // Verzögerung in Millisekunden
            showMarker: true, // Zeigt einen Marker für das Suchergebnis an
            showPopup: false, // Deaktiviert das Popup für den Marker
        });
        mymap.addControl(search);

        // GPX-Datei einbinden
        var gpx = 'e10.gpx'; // URL zur GPX-Datei
        new L.GPX(gpx, {
            async: true,
            marker_options: {
                startIconUrl: 'https://www.mapbox.com/help/demos/custom-markers-gl-js/mapbox-icon.png',
                endIconUrl: 'https://www.mapbox.com/help/demos/custom-markers-gl-js/mapbox-icon.png',
                shadowUrl: ''
            }
        }).on('loaded', function(e) {
            mymap.fitBounds(e.target.getBounds());
        }).addTo(mymap);
    </script>
</body>
</html>
